<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gui Informa - Dashboard Interativo</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0f172a; /* Azul muito escuro */
            --card-bg: #1e293b;   /* Azul acinzentado */
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --accent-blue: #3b82f6;
            --border-color: #334155;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
        }

        .container { max-width: 1200px; margin: 0 auto; }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        h1 { margin: 0; font-size: 1.5rem; font-weight: 600; letter-spacing: -0.5px; }
        .status-badge {
            background: rgba(16, 185, 129, 0.1);
            color: var(--accent-green);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            border: 1px solid rgba(16, 185, 129, 0.2);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .status-dot { height: 8px; width: 8px; background-color: var(--accent-green); border-radius: 50%; display: inline-block; animation: pulse 2s infinite; }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Grid Layout */
        .grid-dashboard {
            display: grid;
            grid-template-columns: 2fr 1fr; /* Gr√°fico ocupa 2/3, Tabelas 1/3 */
            gap: 20px;
        }
        
        @media (max-width: 900px) {
            .grid-dashboard { grid-template-columns: 1fr; }
        }

        /* Cards Gen√©ricos */
        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* Destaques Superiores */
        .highlights {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .highlight-card h3 { color: var(--text-secondary); font-size: 0.9rem; margin: 0 0 10px 0; font-weight: 400; }
        .highlight-value { font-size: 1.8rem; font-weight: 600; }
        .highlight-var { font-size: 0.9rem; margin-top: 5px; font-weight: 500; }

        /* Controles do Gr√°fico */
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .chart-controls {
            display: flex;
            gap: 8px;
            background: rgba(15, 23, 42, 0.5);
            padding: 4px;
            border-radius: 8px;
        }
        .chart-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .chart-btn:hover { color: var(--text-primary); }
        .chart-btn.active {
            background-color: var(--accent-blue);
            color: white;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
        }

        /* Tabelas */
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        th { text-align: left; color: var(--text-secondary); padding: 12px 0; font-weight: 400; border-bottom: 1px solid var(--border-color); }
        td { padding: 15px 0; border-bottom: 1px solid rgba(51, 65, 85, 0.5); }
        .col-price { text-align: right; font-weight: 600; font-family: 'Courier New', monospace; letter-spacing: -0.5px; }
        .col-var { text-align: right; }
        
        /* Not√≠cias (NOVO CSS) */
        .news-list { list-style: none; padding: 0; margin: 0; }
        .news-item { 
            border-bottom: 1px solid rgba(51, 65, 85, 0.5); 
            padding: 15px 0; 
            display: flex; 
            flex-direction: column; 
            gap: 5px;
            transition: background 0.2s;
        }
        .news-item:last-child { border-bottom: none; padding-bottom: 0; }
        .news-item:first-child { padding-top: 0; }
        
        .news-link { 
            color: var(--text-primary); 
            text-decoration: none; 
            font-weight: 500; 
            font-size: 0.95rem; 
            line-height: 1.4;
        }
        .news-link:hover { color: var(--accent-blue); }
        
        .news-meta { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            font-size: 0.75rem; 
            color: var(--text-secondary); 
        }
        .news-tag { 
            background: rgba(59, 130, 246, 0.1); 
            color: var(--accent-blue); 
            padding: 2px 6px; 
            border-radius: 4px; 
            font-weight: 600;
        }

        /* Cores de Varia√ß√£o */
        .up { color: var(--accent-green); }
        .down { color: var(--accent-red); }

        /* Footer */
        footer { margin-top: 40px; text-align: center; color: var(--text-secondary); font-size: 0.8rem; }
        a { color: var(--accent-blue); text-decoration: none; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div>
            <h1>Gui Informa</h1>
            <span style="color: var(--text-secondary); font-size: 0.9rem;">Monitoramento Financeiro em Tempo Real</span>
        </div>
        <div class="status-badge">
            <span class="status-dot"></span> Ao vivo
        </div>
    </header>

    <div class="highlights">
        <div class="card highlight-card">
            <h3>D√≥lar Comercial</h3>
            <div class="highlight-value" id="main-usd">---</div>
            <div class="highlight-var" id="var-usd">---</div>
        </div>
        <div class="card highlight-card">
            <h3>Bitcoin</h3>
            <div class="highlight-value" id="main-btc">---</div>
            <div class="highlight-var" id="var-btc">---</div>
        </div>
        <div class="card highlight-card">
            <h3>Euro</h3>
            <div class="highlight-value" id="main-eur">---</div>
            <div class="highlight-var" id="var-eur">---</div>
        </div>
    </div>

    <div class="grid-dashboard">
        <!-- Coluna da Esquerda (Gr√°fico + Not√≠cias) -->
        <div style="display: flex; flex-direction: column; gap: 20px;">
            <div class="card">
                <div class="chart-header">
                    <h3 style="margin:0;" id="chart-title">Tend√™ncia D√≥lar (30 Dias)</h3>
                    
                    <div class="chart-controls">
                        <button onclick="updateChart('USD-BRL', 'D√≥lar')" class="chart-btn active">D√≥lar</button>
                        <button onclick="updateChart('EUR-BRL', 'Euro')" class="chart-btn">Euro</button>
                        <button onclick="updateChart('BTC-BRL', 'Bitcoin')" class="chart-btn">Bitcoin</button>
                    </div>
                </div>
                
                <div style="position: relative; height: 350px; width: 100%;">
                    <canvas id="marketChart"></canvas>
                </div>
            </div>

            <!-- NOVA SE√á√ÉO DE NOT√çCIAS -->
            <div class="card">
                <h3 style="margin-top:0; margin-bottom:15px; color: #fff; display:flex; align-items:center; gap:10px;">
                    üì∞ √öltimas do Mercado <span style="font-size:0.7rem; color:var(--text-secondary); font-weight:400;">(Fonte: G1 Economia)</span>
                </h3>
                <ul id="news-list" class="news-list">
                    <li style="color: var(--text-secondary); text-align: center; padding: 20px;">Carregando not√≠cias...</li>
                </ul>
            </div>
        </div>

        <!-- Coluna da Direita (Tabelas) -->
        <div style="display: flex; flex-direction: column; gap: 20px;">
            <div class="card">
                <h3 style="margin-top:0; margin-bottom:15px; color: #fff;">Moedas Globais</h3>
                <table id="fiat-table">
                    <thead>
                        <tr>
                            <th>Moeda</th>
                            <th class="col-price">Pre√ßo</th>
                            <th class="col-var">24h %</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <div class="card">
                <h3 style="margin-top:0; margin-bottom:15px; color: #fff;">Criptoativos</h3>
                <table id="crypto-table">
                    <thead>
                        <tr>
                            <th>Ativo</th>
                            <th class="col-price">Pre√ßo</th>
                            <th class="col-var">24h %</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <footer>
        Dados fornecidos por <a href="https://docs.awesomeapi.com.br" target="_blank">AwesomeAPI</a> e G1.
    </footer>
</div>

<script>
    // --- Configura√ß√µes ---
    const API_URL_LAST = 'https://economia.awesomeapi.com.br/last/USD-BRL,EUR-BRL,GBP-BRL,CAD-BRL,JPY-BRL,BTC-BRL,ETH-BRL,LTC-BRL';
    // URL do RSS do G1 Economia convertido para JSON
    const NEWS_API_URL = 'https://api.rss2json.com/v1/api.json?rss_url=https://g1.globo.com/dynamo/economia/rss2.xml';
    
    const fiatList = ['USDBRL', 'EURBRL', 'GBPBRL', 'CADBRL', 'JPYBRL'];
    const cryptoList = ['BTCBRL', 'ETHBRL', 'LTCBRL'];
    let myChart = null;

    // --- Formatadores ---
    const formatCurrency = (value) => {
        return parseFloat(value).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    };

    const getVariationElement = (pct) => {
        const val = parseFloat(pct);
        const icon = val >= 0 ? '‚ñ≤' : '‚ñº';
        const colorClass = val >= 0 ? 'up' : 'down';
        return `<span class="${colorClass}" style="font-weight:500;">${icon} ${val.toFixed(2)}%</span>`;
    };

    // --- L√≥gica Principal ---

    // 1. Buscar Not√≠cias (NOVO)
    async function fetchNews() {
        try {
            const response = await fetch(NEWS_API_URL);
            const data = await response.json();
            
            const newsList = document.getElementById('news-list');
            
            if(data.status === 'ok') {
                newsList.innerHTML = ''; // Limpa o "Carregando..."
                
                // Pega as 4 primeiras not√≠cias
                data.items.slice(0, 4).forEach(item => {
                    // Formatar data (ex: 2024-05-20 10:00:00 -> 20/05 √†s 10:00)
                    const dateObj = new Date(item.pubDate);
                    const dateStr = dateObj.toLocaleDateString('pt-BR', {day: '2-digit', month:'2-digit'}) + ' √†s ' + dateObj.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'});

                    const li = document.createElement('li');
                    li.className = 'news-item';
                    li.innerHTML = `
                        <a href="${item.link}" target="_blank" class="news-link">${item.title}</a>
                        <div class="news-meta">
                            <span class="news-tag">Mercado</span>
                            <span>${dateStr}</span>
                        </div>
                    `;
                    newsList.appendChild(li);
                });
            }
        } catch (error) {
            console.error("Erro ao carregar not√≠cias:", error);
            document.getElementById('news-list').innerHTML = '<li style="padding:15px; text-align:center; color:var(--text-secondary)">N√£o foi poss√≠vel carregar as not√≠cias no momento.</li>';
        }
    }

    // 2. Atualizar Pre√ßos
    async function fetchData() {
        try {
            const response = await fetch(API_URL_LAST);
            const data = await response.json();

            updateHighlight('main-usd', 'var-usd', data.USDBRL);
            updateHighlight('main-btc', 'var-btc', data.BTCBRL);
            updateHighlight('main-eur', 'var-eur', data.EURBRL);

            fillTable('fiat-table', fiatList, data);
            fillTable('crypto-table', cryptoList, data);

        } catch (error) {
            console.error("Erro na API:", error);
        }
    }

    function updateHighlight(idVal, idVar, item) {
        document.getElementById(idVal).innerText = formatCurrency(item.bid);
        document.getElementById(idVar).innerHTML = getVariationElement(item.pctChange);
    }

    function fillTable(tableId, keys, data) {
        const tbody = document.querySelector(`#${tableId} tbody`);
        tbody.innerHTML = ''; 

        keys.forEach(key => {
            const item = data[key];
            if(!item) return;

            let name = item.name.split('/')[0];
            if(name === 'Libra Esterlina') name = 'Libra';
            if(name === 'D√≥lar Canadense') name = 'D√≥lar CAD';

            const row = `
                <tr>
                    <td>${name}</td>
                    <td class="col-price">${formatCurrency(item.bid)}</td>
                    <td class="col-var">${getVariationElement(item.pctChange)}</td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }

    // 3. Gr√°fico Din√¢mico
    async function updateChart(pair, label) {
        document.querySelectorAll('.chart-btn').forEach(btn => {
            btn.classList.remove('active');
            if(btn.innerText === label) btn.classList.add('active');
        });

        document.getElementById('chart-title').innerText = `Tend√™ncia ${label} (30 Dias)`;
        const ctx = document.getElementById('marketChart').getContext('2d');

        try {
            const response = await fetch(`https://economia.awesomeapi.com.br/json/daily/${pair}/30`);
            const rawData = await response.json();
            
            const labels = rawData.map(i => new Date(i.timestamp * 1000).toLocaleDateString('pt-BR', {day:'2-digit', month:'2-digit'})).reverse();
            const values = rawData.map(i => i.bid).reverse();

            let gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(59, 130, 246, 0.5)');
            gradient.addColorStop(1, 'rgba(59, 130, 246, 0.0)');

            if (myChart) { myChart.destroy(); }

            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `Pre√ßo (${label})`,
                        data: values,
                        borderColor: '#3b82f6',
                        borderWidth: 2,
                        backgroundColor: gradient,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 6,
                        pointBackgroundColor: '#3b82f6'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { intersect: false, mode: 'index' },
                    scales: {
                        x: { grid: { display: false, color: '#334155' }, ticks: { color: '#94a3b8', font: {size: 11} } },
                        y: { grid: { color: '#334155', borderDash: [5, 5] }, ticks: { color: '#94a3b8', font: {size: 11} } }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#1e293b',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: '#334155',
                            borderWidth: 1,
                            padding: 10,
                            displayColors: false,
                            callbacks: {
                                label: function(context) { return Number(context.parsed.y).toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'}); }
                            }
                        }
                    }
                }
            });
        } catch (err) { console.error("Erro gr√°fico", err); }
    }

    // Inicializa√ß√£o
    fetchData();
    fetchNews(); // Chama as not√≠cias
    updateChart('USD-BRL', 'D√≥lar');
    setInterval(fetchData, 30000);

</script>
</body>
</html>
